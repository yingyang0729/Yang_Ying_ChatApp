// imports will always go at the top
import ChatMsg from './modules/ChatMsg.js';

const socket = io();

//utility functions for socket
function setUserID ({ sID }) {

    //save our uniique ID generated by Socket on the server side - this is how we track individual connections to the chat service
    vm.socketID = sID;

}

function showNewMessage( { message }) {
    //debugger;
    vm.messages.push(message);
}

function handleUserTyping(user) {
  console.log('somebody is typing something');
}

  const { createApp } = Vue

  const vm = createApp({
    data() {
      return {
        socketID: '',
        message: '',
        messages: [],

        nickname: '',
        username:'',
        openlogin: true,
        openchat: false
      }
    }, 

    methods: {
        dispatchMessage() {
            socket.emit('chat_message', {
                content: this.message,
                name: this.nickname || 'anonymous',
                id: this.socketID
            })

            this.message = "";
        },

        catchTextFocus() {
          // emit a custom typing event and broadcast it to the server
          socket.emit('user_typing', {
            name: this.nickname || 'anonymous'
          })
        },

        catchUsername() {
          // emit a custom typing event and broadcast it to the server
          socket.emit('user_typing', {
            name: this.username || 'anonymous'
          })
        },

        showChat() {
          this.openlogin = !this.openlogin
          this.openchat = !this.openchat
        }
    },

    components: {
        newmsg: ChatMsg
    }

  }).mount('#app')

socket.addEventListener('connected', setUserID);
socket.addEventListener('new_message', showNewMessage);
socket.addEventListener('typing', handleUserTyping);

